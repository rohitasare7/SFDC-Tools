import{_ as ue}from"./B4TJsizH.js";import{_ as de}from"./BCUAfS-d.js";import{f as ge,g as G,s as me,u as D,r as fe,h as pe,i as ye,d as xe}from"./ycDIoMx1.js";import{r as ve,h as he,a as ke}from"./BWsKriaw.js";import{a as l,f as be}from"./COAcYwch.js";import{_ as we}from"./C0MpYsF0.js";import{_ as x}from"./CKP9D31c.js";import{_ as _e,a as h}from"./CuTdjjvY.js";import{_ as M}from"./9nx4tXco.js";import{_ as E}from"./BA2uKlca.js";import Se from"./BIWGegK8.js";import{D as Le}from"./NYwah7P7.js";import{u as Oe}from"./bkTsuWyN.js";import{o as m,c as f,b as i,f as Ce,r as p,i as Te,n as H,d as a,w as n,e as c,u,x as Re,s as b,t as A,F as W,y as De,q as U,v as Ee}from"./Ho11KFCP.js";import{u as Ae}from"./Z-iyx2tQ.js";import{r as Ue}from"./J0KE5HEr.js";import{r as Ne,a as Z}from"./T9FkOv9P.js";import{r as K}from"./DLsSqBkb.js";import"./BhtQlZEJ.js";import"./DwUi_19Z.js";import"./BmYiYK0q.js";function $e(Q,v){return m(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}const Ie={class:"mx-4 mb-4"},Ve={class:"flex flex-col md:flex-row mx-4 justify-between"},Me={class:"space-x-3 flex items-left"},Fe={class:"space-x-3 flex items-right"},Pe={key:0,class:"mx-4 mt-8"},Be={class:"text-left ml-2"},Je=["onClick"],je={class:"flex items-center justify-center mb-2"},qe={class:"inline-block"},Ye={class:"flex w-full h-2 bg-gray-200 rounded-full overflow-hidden dark:bg-gray-700",role:"progressbar","aria-valuenow":"25","aria-valuemin":"0","aria-valuemax":"100"},ze={key:2,class:"bg-sky-50 hover:bg-sky-100 text-sky-600 border-blue-100 hover:dark:bg-slate-500 dark:bg-slate-600 text-xs font-medium dark:text-slate-300 border dark:border-slate-500 text-center py-2 px-3 leading-none rounded-3xl transition duration-500"},Ge={class:"text-center"},He={class:"relative bg-white rounded-lg shadow dark:bg-gray-700"},We={class:"p-4 pb-10 text-center"},Ze={key:0,class:"flex items-center justify-center p-4 pb-10 text-center"},Ke={key:1},Qe={class:"relative bg-white rounded-lg shadow dark:bg-gray-700"},Xe={class:"p-4 pb-10 text-center"},et={key:0,class:"flex items-center justify-center p-4 pb-10 text-center"},tt={key:1},st="issued_at",rt="desc",k="Please re-authenticate, you can also check console for details.",Lt=Ce({__name:"orgs",setup(Q){Oe({title:"Manage Your Orgs | SFDC Developer Toolkit",ogTitle:"Manage Your Orgs | SFDC Developer Toolkit",description:"You can manage your Salesforce orgs including adding new, deleting existing, and refreshing their auth tokens.",ogDescription:"You can manage your Salesforce orgs including adding new, deleting existing, and refreshing their auth tokens."});const v=p(!1),w=p(""),_=p(!1),S=p(!1);function F(s){s.forEach(({ref:e,newValue:o})=>{e.value=o})}const P=Ee(),B=P.public.SF_CLIENT_ID,J=P.public.SF_REDIRECT_URI,d=p([]),X=["instance_url","org_type","auth_user","issued_at"],N=p(""),ee=[{text:"Instance URL",value:"instance_url"},{text:"API Usage",value:"org_limit",width:150},{text:"Org Type",value:"org_type",sortable:!0},{text:"Authenticated at",value:"issued_at",sortable:!0},{text:"Actions",value:"Actions"}],L=async s=>{_.value=!0;try{d.value=ge();const e=await G();console.log("session --> "+JSON.stringify(e)),e.orgLimitList&&d.value.forEach(o=>{const r=e.orgLimitList.find(t=>t.orgURL===o.instance_url);r&&(o.org_limit=r.limit)})}catch(e){l("Error Occured while fetching data, check console","Error"),console.error(k,e)}F([{ref:_,newValue:!1}])},j=async(s,e=!0)=>{const o=await $(s);if(console.log("1 orgToUpdate --> "+o),!o){l("No org to update in this session.","Error");return}try{const r=await ke(s);console.log("2 revokeAuthToken --> :",JSON.stringify(r.value));const t=r==null?void 0:r.success,g=t?r==null?void 0:r.message:k;xe(s),e&&(L(!1),l(g,t?"Success":"Error")),await D({selectedOrg:{}}),t||console.error("Error fetching Salesforce token:",JSON.stringify(r))}catch(r){e&&l(k,"Error"),console.error("revokeAuthToken Catch block error --> ",r)}},q=async(s,e,o)=>{if(!await $(s)){l("No org to update in this session.","Error");return}try{const t=await ve(e,o);if(console.log("data renew -->"+JSON.stringify(t)),t!=null&&t.access_token){let g=be(Number(t==null?void 0:t.issued_at));me(t==null?void 0:t.instance_url,t==null?void 0:t.access_token,o,g,e),L(!1),l("Auth token refreshed successfully.","Success")}else L(!1),l(k,"Error"),console.error("Error fetching Salesforce token:",JSON.stringify(t.value))}catch(t){l(k,"Error"),console.error("Error calling SF APIs:",t)}},te=(s,e)=>((e-s)/e*100).toFixed(2),$=async s=>{var o;const e=d.value.find(r=>r.instance_url===s);if(console.log("orgToUpdate --> "+JSON.stringify(e)),e){const r=await D({selectedOrg:e});return console.log("updateSession --> "+JSON.stringify(r)),((o=r==null?void 0:r.selectedOrg)==null?void 0:o.instance_url)==s}},se=async(s,e)=>{const o=await Y();console.log("currentOrgList --> "+JSON.stringify(o));const r=o.findIndex(t=>t.orgURL===s);r!==-1?o[r]={orgURL:s,limit:e}:o.push({orgURL:s,limit:e}),await D({orgLimitList:o})},Y=async()=>{var e;const s=await G();return console.log("sessionData -> "+JSON.stringify(s)),((e=s==null?void 0:s.orgLimitList)==null?void 0:e.length)>0?s==null?void 0:s.orgLimitList:[]},re=async s=>{if(v.value){l("Please wait for previous request to complete.","Error");return}v.value=!0,w.value=s;try{if(!await $(s)){l("No org to update in this session.","Error");return}await H();const o=await he("OrgLimits",null,null,"GET");if(o!=null&&o.DailyApiRequests){const r=d.value.find(t=>t.instance_url===s);r&&(r.org_limit=te(o==null?void 0:o.DailyApiRequests.Remaining,o==null?void 0:o.DailyApiRequests.Max),se(s,r.org_limit),l(`Current Org API Usage: ${r.org_limit}%`,"Success"))}else if(o=="AUTH_ERROR"){const r=d.value.find(t=>t.instance_url===s);r&&(await q(r.instance_url,r.org_type,r.refresh_token),v.value=!1)}else l("Some error has occured, please re-authenticate the org","Error")}catch(e){l(k,"Error"),console.log("Error fetching org Limit :",e)}F([{ref:v,newValue:!1},{ref:w,newValue:""}])},oe=()=>{if(d.value.length==0){l("No orgs to reset.","Error");return}I.value=!0},ae=async()=>{S.value=!0;try{for(const s of d.value)await new Promise(e=>{setTimeout(async()=>{await j(s.instance_url,!1),e()},1e3)});fe(),d.value=[],localStorage.removeItem("default_org"),await D({orgLimitList:[]}),y(),l("All orgs removed successfully","Success"),S.value=!1}catch(s){S.value=!1,l(k,"Error"),console.error(s)}},ne=async()=>{var r,t,g,O,R,C;const s=await Ae("/api/userData","$SDq5uGZjxW"),e={table:"users",fields:"email",filter:{compareTo:"email",CompareValue:(t=(r=s.data.value)==null?void 0:r.user)==null?void 0:t.email}};if(!((await pe(e)).length>0)){const ce={table:"users",insertValues:[{name:(O=(g=s.data.value)==null?void 0:g.user)==null?void 0:O.name,email:(C=(R=s.data.value)==null?void 0:R.user)==null?void 0:C.email}],selectValues:"id, name, email"};await ye(ce)}},ie=async()=>{const s=await Y();console.log("orgLimitList --> "+JSON.stringify(s)),s.forEach(e=>{d.value.forEach(o=>{o.instance_url==e.orgURL&&(o.org_limit=e.limit)})})},I=p(!1),y=()=>{I.value=!1,T.value=!1},T=p(!1),V=p(""),z=s=>{T.value=!0,V.value=s},le=async()=>{T.value=!0,await j(V.value,!0),y()};return Te(async()=>{await H(),await L(),await ie(),await ne()}),(s,e)=>{const o=ue,r=de;return m(),f(W,null,[i("div",Ie,[a(_e,null,{default:n(()=>e[2]||(e[2]=[c("Manage Your Orgs")])),_:1}),a(h,null,{default:n(()=>e[3]||(e[3]=[c("You can manage your Salesforce orgs including adding new, deleting existing, and refreshing their auth tokens.")])),_:1})]),i("div",Ve,[i("div",Me,[a(we,{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=t=>N.value=t),type:"text",class:"!px-2 !py-1",placeholder:"Search Orgs.."},null,8,["modelValue"]),a(x,null,{default:n(()=>[a(o,{to:`https://test.salesforce.com/services/oauth2/authorize?client_id=${u(B)}&redirect_uri=${u(J)}&response_type=code&prompt=login&state=sandbox`,target:"_self",external:""},{default:n(()=>e[4]||(e[4]=[c("Auth Sandbox")])),_:1},8,["to"])]),_:1}),a(x,null,{default:n(()=>[a(o,{to:`https://login.salesforce.com/services/oauth2/authorize?client_id=${u(B)}&redirect_uri=${u(J)}&response_type=code&prompt=login&state=production`,target:"_self",external:""},{default:n(()=>e[5]||(e[5]=[c("Auth Production")])),_:1},8,["to"])]),_:1})]),i("div",Fe,[a(x,{onClick:e[1]||(e[1]=t=>L()),class:b({"!p-2":_.value})},{default:n(()=>[_.value?(m(),Re(E,{key:0,cssStyle:"h-4 w-4"})):(m(),f("p",{key:1,class:b({"ml-2":_.value})},"Refresh Org List",2))]),_:1},8,["class"]),a(x,{onClick:oe,isRed:!0},{default:n(()=>e[6]||(e[6]=[c("Reset Data")])),_:1})])]),d.value&&d.value.length>0?(m(),f("div",Pe,[a(u(Le),{headers:ee,items:d.value,"search-field":X,"rows-per-page":10,"header-text-direction":"center","search-value":N.value,"sort-by":st,"sort-type":rt,"no-hover":!0,"theme-color":"#312e3d","body-text-direction":"center","table-class-name":"tableCSS mb-12 rounded-lg border dark:border-gray-600 shadow-md"},{"empty-message":n(()=>e[7]||(e[7]=[i("p",{class:"font-semibold my-4"},"No data present, please click Refresh List button.",-1)])),loading:n(()=>e[8]||(e[8]=[i("p",{class:"font-semibold my-4"},"Data loading, please wait...",-1)])),"item-instance_url":n(({instance_url:t})=>[i("p",Be,A(t),1)]),"item-org_limit":n(({org_limit:t,instance_url:g})=>[i("button",{onClick:O=>re(g),class:"w-full"},[t&&w.value!=g?(m(),f(W,{key:0},[i("div",je,[i("div",{class:b(["inline-block py-0.5 px-1.5 border text-xs font-medium rounded-lg",{"bg-green-50 border-green-200 text-green-600 dark:bg-green-800/30 dark:text-green-500 dark:border-green-800":t<=80,"bg-red-50 border-red-200 text-red-600 dark:bg-red-800/30 dark:text-red-300 dark:border-red-800":t>80}])},A(t)+"%",3),i("div",qe,[a(u(Se),{class:"w-4 h4 ml-1 text-gray-500 dark:text-gray-400",fontControlled:!1})])]),i("div",Ye,[i("div",{class:b(["flex flex-col justify-center rounded-full overflow-hidden text-xs text-white text-center whitespace-nowrap transition duration-500",{"bg-green-500":t<=80,"bg-red-500 ":t>80}]),style:De({width:`${t}%`})},null,6)])],64)):U("",!0),v.value&&w.value==g?(m(),f("button",{key:1,class:b(["bg-sky-50 hover:bg-sky-100 text-sky-600 border-blue-100 hover:dark:bg-slate-500 dark:bg-slate-600 text-xs font-medium dark:text-slate-300 border dark:border-slate-500 text-center py-2 px-3 leading-none rounded-3xl transition duration-500",{"!p-2":v.value}])},[a(E,{cssStyle:"h-4 w-4"})],2)):U("",!0),!t&&w.value!=g?(m(),f("button",ze," Check Limit ")):U("",!0)],8,Je)]),"item-org_type":n(({org_type:t})=>[i("p",{class:b(["capitalize font-semibold",{"text-indigo-700 dark:text-indigo-200":t=="production","text-teal-700 dark:text-teal-200":t=="sandbox"}])},A(t),3)]),"item-Actions":n(({instance_url:t,access_token:g,org_type:O,refresh_token:R})=>[i("div",Ge,[a(M,{icon:u($e),color:"gray",onClick:C=>z(t),class:"mr-2 my-2",title:"Make Default Org"},null,8,["icon","onClick"]),a(M,{icon:u(Ue),color:"blue",onClick:C=>q(t,O,R),class:"mr-2 my-2",title:"Renew Access Token"},null,8,["icon","onClick"]),a(M,{icon:u(Ne),color:"red",onClick:C=>z(t),class:"mr-2 my-2",title:"Revoke Org"},null,8,["icon","onClick"])])]),_:1},8,["items","search-value"])])):U("",!0),a(r,{show:I.value,onClose:y,cssStyle:"mt-48 !max-w-screen-xl"},{default:n(()=>[i("div",He,[i("button",{type:"button",onClick:y,class:"absolute top-3 end-3 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-600 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:bg-gray-600 dark:text-white dark:hover:bg-gray-500 transition duration-150 ease-in-out"},[a(u(K),{class:"w-6 h-6"}),e[9]||(e[9]=i("span",{class:"sr-only"},"Close modal",-1))]),i("div",We,[a(u(Z),{class:"mx-auto mb-4 text-red-500 w-12 h-12 dark:text-gray-400"}),a(h,{class:"text-lg text-gray-700"},{default:n(()=>e[10]||(e[10]=[c("Are you sure you want to reset?")])),_:1}),a(h,{class:"text-sm text-gray-600 mb-4"},{default:n(()=>e[11]||(e[11]=[c("This action will revoke all authentication tokens and delete stored organizations. This action cannot be undone.")])),_:1}),S.value?(m(),f("div",Ze,[a(E,{cssStyle:"h-6 w-6 mr-2 text-gray-600 dark:text-gray-100"}),a(h,{class:"text-lg text-gray-700"},{default:n(()=>e[12]||(e[12]=[c("Resetting data..")])),_:1})])):(m(),f("div",Ke,[a(x,{onClick:ae,isRed:!0,class:"mr-4"},{default:n(()=>e[13]||(e[13]=[c("Yes, I'm sure")])),_:1}),a(x,{onClick:y},{default:n(()=>e[14]||(e[14]=[c("No, cancel")])),_:1})]))])])]),_:1},8,["show"]),a(r,{show:T.value,onClose:y,cssStyle:"mt-48 !max-w-screen-xl"},{default:n(()=>[i("div",Qe,[i("button",{type:"button",onClick:y,class:"absolute top-3 end-3 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-600 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:bg-gray-600 dark:text-white dark:hover:bg-gray-500 transition duration-150 ease-in-out"},[a(u(K),{class:"w-6 h-6"}),e[15]||(e[15]=i("span",{class:"sr-only"},"Close modal",-1))]),i("div",Xe,[a(u(Z),{class:"mx-auto mb-4 text-red-500 w-12 h-12 dark:text-gray-400"}),a(h,{class:"text-lg text-gray-700"},{default:n(()=>e[16]||(e[16]=[c("Do you want to revoke access to this org? ")])),_:1}),a(h,{class:"text-sm text-gray-600 mb-4"},{default:n(()=>[e[17]||(e[17]=c("This action will revoke the authentication token and remove org from this list. No org data is altered. ")),e[18]||(e[18]=i("br",null,null,-1)),e[19]||(e[19]=c(" Org URL : ")),i("b",null,A(V.value),1)]),_:1}),S.value?(m(),f("div",et,[a(E,{cssStyle:"h-6 w-6 mr-2 text-gray-600 dark:text-gray-100"}),a(h,{class:"text-lg text-gray-700"},{default:n(()=>e[20]||(e[20]=[c("Removing org..")])),_:1})])):(m(),f("div",tt,[a(x,{onClick:le,isRed:!0,class:"mr-4"},{default:n(()=>e[21]||(e[21]=[c("Yes, I'm sure")])),_:1}),a(x,{onClick:y},{default:n(()=>e[22]||(e[22]=[c("No, cancel")])),_:1})]))])])]),_:1},8,["show"])],64)}}});export{Lt as default};
