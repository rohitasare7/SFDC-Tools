import{s as p}from"./ycDIoMx1.js";import{f as h,a as t}from"./COAcYwch.js";import{_ as w}from"./D7mtGAGI.js";import{f as y,h as k,i as v,n as _,o as x,c as b,b as o,d as T,w as S,e as B,j as n}from"./Ho11KFCP.js";import{u as C}from"./Z-iyx2tQ.js";import"./BhtQlZEJ.js";const N={class:"p-10 bg-gray-200 dark:bg-gray-700 flex items-center justify-center rounded shadow-md border border-gray-300 dark:border-gray-800"},$=y({__name:"sfdc",setup(E){const c=k(),m=async()=>{var s,e,i,l,u,d;try{const{code:r}=c.query,{state:f}=c.query,{data:a}=await C("/api/sfdc/auth",{query:{code:r,state:f},server:!0},"$YvfBGTvXJ4");if((s=a.value)!=null&&s.access_token){let g=h(Number((e=a.value)==null?void 0:e.issued_at));await p((i=a.value)==null?void 0:i.instance_url,(l=a.value)==null?void 0:l.access_token,(u=a.value)==null?void 0:u.refresh_token,g,String(f)),t("Org has been authenticated successfully.","Success"),await n("/settings/orgs")}else((d=a.value)==null?void 0:d.error)=="invalid_grant"?(t("Please re-authenticaate org as authorization code has been expired.","Error"),await n("/settings/orgs")):(t("No action taken, re-directing to org list page.","Success"),await n("/settings/orgs"))}catch(r){t("Something has failed, please check console","Error"),console.error("Error fetching Salesforce token:",r)}};return v(async()=>{await _(),await m()}),(s,e)=>(x(),b("div",N,[e[1]||(e[1]=o("svg",{class:"animate-spin -ml-1 mr-3 h-10 w-10 text-gray-700 dark:text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),T(w,null,{default:S(()=>e[0]||(e[0]=[B("Processing Data Please Wait..")])),_:1})]))}});export{$ as default};
